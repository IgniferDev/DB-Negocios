<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>DSS - Inicio</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <nav style="display:flex; gap:12px; align-items:center; margin-bottom:16px;">
    <a href="/" style="font-weight:700; font-size:18px;">DSS - Inicio</a>
    <a href="/dashboard">Dashboard</a>
    <a href="/cube">Cubo OLAP</a>
    <a href="/bsc">Balanced Scorecard</a>
    <a href="/">Predict</a>
  </nav>

  <div class="card" style="max-width:900px;">
    <h1>Bienvenido al Sistema de Soporte de Decisión</h1>
    <p class="small">Utiliza el menú para navegar. En este entorno local encontrarás:</p>
    <ul>
      <li>Dashboard con KPIs y gráficas interactivas.</li>
      <li>Cubo OLAP: caras, secciones y celdas (datos soporte).</li>
      <li>Balanced Scorecard (OKRs) y predicción de defectos (modelo Rayleigh).</li>
    </ul>

    <h3>Predicción rápida</h3>
    <form id="predictForm" onsubmit="return doPredict(event)" style="display:flex; gap:8px; align-items:center;">
      <label>Horas estimadas: <input id="ph" type="number" required min="1" style="width:120px"></label>
      <label>Token: <input id="token" type="text" value="CHANGE_ME_TOKEN" style="width:200px"></label>
      <button type="submit">Predecir</button>
    </form>

    <div class="card" style="margin-top:12px;">
      <h4>Qué devuelve la predicción (explicación rápida)</h4>
      <p><strong>predicted_defects</strong>: la predicción puntual (esperanza) del número de defectos para un proyecto con las horas indicadas (valor esperado bajo el modelo Rayleigh entrenado).</p>
      <p><strong>p50</strong> (percentil 50): mediana — 50% de probabilidad de que el número real de defectos sea menor o igual a este valor.</p>
      <p><strong>p10 / p90</strong>: percentiles 10% y 90%. p10 = valor que solo se supera en 10% de los casos (escenario optimista), p90 = valor que se supera en 90% de los casos (escenario pesimista).</p>
      <p><strong>sigma</strong>: parámetro del modelo Rayleigh entrenado a partir de historial (mide escala); el equipo lo usa para transformar horas esperadas en densidad de defectos.</p>
      <p><strong>Interpretación práctica</strong>:
        <ul>
          <li>Si <strong>p50 &gt; 5</strong>: alto riesgo de defectos — asignar más QA / pruebas automáticas.</li>
          <li>Si <strong>p90 &gt; 8</strong>: preparar plan de mitigación, pruebas y presupuesto para corregir fallas.</li>
          <li>Si p10 pequeño y p90 grande → alta incertidumbre: revisar estimación de horas y complejidad.</li>
        </ul>
      </p>
    </div>

    <pre id="predict_out" style="margin-top:12px"></pre>
  </div>

<script>
async function doPredict(e){
  e.preventDefault();
  const hours = Number(document.getElementById('ph').value);
  const token = document.getElementById('token').value || 'CHANGE_ME_TOKEN';
  document.getElementById('predict_out').textContent = 'Solicitando...';
  try{
    const res = await fetch('/predict', {
      method:'POST',
      headers: {'Content-Type':'application/json', 'X-API-KEY': token},
      body: JSON.stringify({project_hours: hours})
    });
    const j = await res.json();
    if(res.status !== 200){
      document.getElementById('predict_out').textContent = "Error: " + JSON.stringify(j);
      return;
    }
    // Formateo agradable
    let txt = '';
    txt += `Predicción (horas = ${hours})\n`;
    txt += `- sigma: ${Number(j.sigma).toFixed(6)}\n`;
    txt += `- Predicted (esperanza): ${Number(j.predicted_defects).toFixed(3)} defectos\n`;
    txt += `- p10 (optimista): ${Number(j.p10).toFixed(3)}\n`;
    txt += `- p50 (mediana): ${Number(j.p50).toFixed(3)}\n`;
    txt += `- p90 (pesimista): ${Number(j.p90).toFixed(3)}\n`;
    txt += `- entrenado en: ${j.trained_on}\n\n`;
    txt += "Interpretación breve:\n";
    if(Number(j.p50) > 5) txt += "- Riesgo ALTO (p50 > 5). Recomendar: más QA y pruebas automáticas.\n";
    else if(Number(j.p50) > 2) txt += "- Riesgo medio (p50 2-5). Revisar estrategia de QA.\n";
    else txt += "- Riesgo bajo (p50 <= 2). Mantener plan normal de QA.\n";
    document.getElementById('predict_out').textContent = txt;
  } catch(err){
    document.getElementById('predict_out').textContent = 'Error: ' + err;
  }
  return false;
}
</script>
</body>
</html>
